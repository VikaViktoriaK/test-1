<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Test 1</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div style="text-align: center; font-size: 2rem; margin-bottom: 2rem">
      TEST 1
    </div>

    <form
      style="padding: 2rem; display: grid; gap: 2rem"
      action="/example"
      data-att-form="174ff5d5abd65a082e7616ebc2c57e60"
      novalidate
    >
      <div data-custom="test">
        <div class="form-select-chosen">
          <div class="input-wrapper">
            <input
              type="hidden"
              class="form-select-chosen__input"
              name="test"
              required
            />
            <div class="form-select-chosen__output-wrap">
              <div
                class="form-select-chosen__output"
                data-placeholder="Ваша страна проживания"
              ></div>
            </div>
            <svg
              width="18"
              height="9"
              viewBox="0 0 18 9"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              class="input-arrow"
            >
              <path
                d="M9.00002 8.79989C8.30002 8.79989 7.60002 8.52989 7.07002 7.99989L0.55002 1.47989C0.26002 1.18989 0.26002 0.709893 0.55002 0.419893C0.84002 0.129893 1.32002 0.129893 1.61002 0.419893L8.13002 6.93989C8.61002 7.41989 9.39002 7.41989 9.87002 6.93989L16.39 0.419893C16.68 0.129893 17.16 0.129893 17.45 0.419893C17.74 0.709893 17.74 1.18989 17.45 1.47989L10.93 7.99989C10.4 8.52989 9.70002 8.79989 9.00002 8.79989Z"
                fill="#292D32"
              />
            </svg>
          </div>
          <div class="form-select-chosen__search">
            <div class="input-search-wrapper">
              <input class="form-select-chosen__search-input" type="text" />
              <svg
                class="search-icon"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.5 21.75C5.85 21.75 1.25 17.15 1.25 11.5C1.25 5.85 5.85 1.25 11.5 1.25C17.15 1.25 21.75 5.85 21.75 11.5C21.75 17.15 17.15 21.75 11.5 21.75ZM11.5 2.75C6.67 2.75 2.75 6.68 2.75 11.5C2.75 16.32 6.67 20.25 11.5 20.25C16.33 20.25 20.25 16.32 20.25 11.5C20.25 6.68 16.33 2.75 11.5 2.75Z"
                  fill="#292D32"
                />
                <path
                  d="M21.9999 22.7499C21.8099 22.7499 21.6199 22.6799 21.4699 22.5299L19.4699 20.5299C19.1799 20.2399 19.1799 19.7599 19.4699 19.4699C19.7599 19.1799 20.2399 19.1799 20.5299 19.4699L22.5299 21.4699C22.8199 21.7599 22.8199 22.2399 22.5299 22.5299C22.3799 22.6799 22.1899 22.7499 21.9999 22.7499Z"
                  fill="#292D32"
                />
              </svg>
            </div>
            <ul class="form-select-chosen__options">
              <li class="form-select-chosen__option" data-value="1">
                Беларусь
              </li>
              <li class="form-select-chosen__option" data-value="2">Россия</li>
              <li class="form-select-chosen__option" data-value="97">
                Австралия
              </li>
              <li class="form-select-chosen__option" data-value="48">
                Австрия
              </li>
              <li class="form-select-chosen__option" data-value="16">
                Азербайджан
              </li>
              <li class="form-select-chosen__option" data-value="104">Алжир</li>
              <li class="form-select-chosen__option" data-value="85">Ангола</li>
              <li class="form-select-chosen__option" data-value="74">
                Аргентина
              </li>
              <li class="form-select-chosen__option" data-value="35">
                Армения
              </li>
              <li class="form-select-chosen__option" data-value="44">
                Бельгия
              </li>
              <li class="form-select-chosen__option" data-value="36">
                Болгария
              </li>
              <li class="form-select-chosen__option" data-value="86">
                Бразилия
              </li>
              <li class="form-select-chosen__option" data-value="87">
                Бурунди
              </li>
              <li class="form-select-chosen__option" data-value="28">
                Великобритания
              </li>
              <li class="form-select-chosen__option" data-value="34">
                Венгрия
              </li>
              <li class="form-select-chosen__option" data-value="95">
                Венесуэла
              </li>
              <li class="form-select-chosen__option" data-value="70">
                Вьетнам
              </li>
              <li class="form-select-chosen__option" data-value="113">Гана</li>
              <li class="form-select-chosen__option" data-value="82">
                Гватемала
              </li>
              <li class="form-select-chosen__option" data-value="13">
                Германия
              </li>
              <li class="form-select-chosen__option" data-value="60">Греция</li>
              <li class="form-select-chosen__option" data-value="12">Грузия</li>
              <li class="form-select-chosen__option" data-value="33">Дания</li>
              <li class="form-select-chosen__option" data-value="10">Другие</li>
              <li class="form-select-chosen__option" data-value="47">Египет</li>
              <li class="form-select-chosen__option" data-value="15">
                Израиль
              </li>
              <li class="form-select-chosen__option" data-value="68">Индия</li>
              <li class="form-select-chosen__option" data-value="101">
                Индонезия
              </li>
              <li class="form-select-chosen__option" data-value="76">
                Иордания
              </li>
              <li class="form-select-chosen__option" data-value="98">Ирак</li>
              <li class="form-select-chosen__option" data-value="45">Иран</li>
              <li class="form-select-chosen__option" data-value="64">
                Ирландия
              </li>
              <li class="form-select-chosen__option" data-value="106">
                Исландия
              </li>
              <li class="form-select-chosen__option" data-value="37">
                Испания
              </li>
              <li class="form-select-chosen__option" data-value="41">Италия</li>
              <li class="form-select-chosen__option" data-value="111">Йемен</li>
              <li class="form-select-chosen__option" data-value="19">
                Казахстан
              </li>
              <li class="form-select-chosen__option" data-value="115">
                Камбоджа
              </li>
              <li class="form-select-chosen__option" data-value="67">
                Камерун
              </li>
              <li class="form-select-chosen__option" data-value="22">Канада</li>
              <li class="form-select-chosen__option" data-value="112">Катар</li>
              <li class="form-select-chosen__option" data-value="20">
                Киргизия
              </li>
              <li class="form-select-chosen__option" data-value="56">Китай</li>
              <li class="form-select-chosen__option" data-value="57">
                Колумбия
              </li>
              <li class="form-select-chosen__option" data-value="116">Конго</li>
              <li class="form-select-chosen__option" data-value="71">Корея</li>
              <li class="form-select-chosen__option" data-value="108">
                Коста-Рика
              </li>
              <li class="form-select-chosen__option" data-value="69">
                Кот-д’Ивуар
              </li>
              <li class="form-select-chosen__option" data-value="50">Куба</li>
              <li class="form-select-chosen__option" data-value="31">Кувейт</li>
              <li class="form-select-chosen__option" data-value="7">Латвия</li>
              <li class="form-select-chosen__option" data-value="46">Ливан</li>
              <li class="form-select-chosen__option" data-value="92">Ливия</li>
              <li class="form-select-chosen__option" data-value="6">Литва</li>
              <li class="form-select-chosen__option" data-value="23">
                Лицо без гр-ва
              </li>
              <li class="form-select-chosen__option" data-value="96">
                Македония
              </li>
              <li class="form-select-chosen__option" data-value="91">
                Малайзия
              </li>
              <li class="form-select-chosen__option" data-value="102">
                Марокко
              </li>
              <li class="form-select-chosen__option" data-value="78">
                Мексика
              </li>
              <li class="form-select-chosen__option" data-value="18">
                Молдова
              </li>
              <li class="form-select-chosen__option" data-value="42">
                Монголия
              </li>
              <li class="form-select-chosen__option" data-value="139">
                Не гражданин
              </li>
              <li class="form-select-chosen__option" data-value="90">Непал</li>
              <li class="form-select-chosen__option" data-value="66">
                Нигерия
              </li>
              <li class="form-select-chosen__option" data-value="25">
                Нидерланды
              </li>
              <li class="form-select-chosen__option" data-value="103">
                Новая Зеландия
              </li>
              <li class="form-select-chosen__option" data-value="59">
                Норвегия
              </li>
              <li class="form-select-chosen__option" data-value="62">ОАЭ</li>
              <li class="form-select-chosen__option" data-value="110">Оман</li>
              <li class="form-select-chosen__option" data-value="119">
                Пакистан
              </li>
              <li class="form-select-chosen__option" data-value="14">Польша</li>
              <li class="form-select-chosen__option" data-value="81">
                Португалия
              </li>
              <li class="form-select-chosen__option" data-value="63">
                Республика Кипр
              </li>
              <li class="form-select-chosen__option" data-value="107">
                Сальвадор
              </li>
              <li class="form-select-chosen__option" data-value="32">
                Саудовская Аравия
              </li>
              <li class="form-select-chosen__option" data-value="100">
                Сенегал
              </li>
              <li class="form-select-chosen__option" data-value="65">Сербия</li>
              <li class="form-select-chosen__option" data-value="114">
                Сингапур
              </li>
              <li class="form-select-chosen__option" data-value="61">
                Словакия
              </li>
              <li class="form-select-chosen__option" data-value="79">
                Словения
              </li>
              <li class="form-select-chosen__option" data-value="80">Судан</li>
              <li class="form-select-chosen__option" data-value="17">США</li>
              <li class="form-select-chosen__option" data-value="49">
                Таджикистан
              </li>
              <li class="form-select-chosen__option" data-value="84">
                Таиланд
              </li>
              <li class="form-select-chosen__option" data-value="88">Тунис</li>
              <li class="form-select-chosen__option" data-value="58">
                Туркменистан
              </li>
              <li class="form-select-chosen__option" data-value="38">Турция</li>
              <li class="form-select-chosen__option" data-value="27">
                Узбекистан
              </li>
              <li class="form-select-chosen__option" data-value="11">
                Украина
              </li>
              <li class="form-select-chosen__option" data-value="109">
                Филиппины
              </li>
              <li class="form-select-chosen__option" data-value="29">
                Финляндия
              </li>
              <li class="form-select-chosen__option" data-value="40">
                Франция
              </li>
              <li class="form-select-chosen__option" data-value="43">
                Хорватия
              </li>
              <li class="form-select-chosen__option" data-value="72">
                Черногория
              </li>
              <li class="form-select-chosen__option" data-value="21">Чехия</li>
              <li class="form-select-chosen__option" data-value="94">Чили</li>
              <li class="form-select-chosen__option" data-value="30">
                Швейцария
              </li>
              <li class="form-select-chosen__option" data-value="24">Швеция</li>
              <li class="form-select-chosen__option" data-value="118">
                Шри-Ланка
              </li>
              <li class="form-select-chosen__option" data-value="93">
                Эль-Сальвадор
              </li>
              <li class="form-select-chosen__option" data-value="5">Эстония</li>
              <li class="form-select-chosen__option" data-value="39">
                Эфиопия
              </li>
              <li class="form-select-chosen__option" data-value="105">ЮАР</li>
              <li class="form-select-chosen__option" data-value="99">
                Южная Корея
              </li>
              <li class="form-select-chosen__option" data-value="75">Япония</li>
            </ul>
          </div>
        </div>
        <span class="input-error" data-error="test" style="display: none"
          >Пожалуйста, выберите страну</span
        >
      </div>

      <button type="submit">Submit</button>
    </form>

    <script src="assets/js/AttForm.js"></script>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        AttForm.create("174ff5d5abd65a082e7616ebc2c57e60", {
          inputInvalidClass: "error-class",
          customInvalidClass: "error-class-custom",
        });

        document.addEventListener("att-form:before", (e) => {
          const { formData, attForm } = e.detail;
          const fields = Object.fromEntries(formData.entries());
          const input = document.querySelector(".form-select-chosen__input");
          const errorMessage = document.querySelector('[data-error="test"]');
          const wrapper = document.querySelector(".input-wrapper");

          if (!fields.test || fields.test.trim() === "") {
            e.preventDefault();
            attForm.setError("test", "Пожалуйста, выберите страну");
            errorMessage.style.display = "block";
            input.classList.add("error-class");
            wrapper.classList.add("error-class");
          } else {
            attForm.clearError("test");
            errorMessage.style.display = "none";
            input.classList.remove("error-class");
            wrapper.classList.remove("error-class");
          }
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const container = document.querySelector(".form-select-chosen");
        const input = container.querySelector(".form-select-chosen__input");
        const output = container.querySelector(".form-select-chosen__output");
        const searchBox = container.querySelector(
          ".form-select-chosen__search",
        );
        const options = container.querySelectorAll(
          ".form-select-chosen__option",
        );
        const arrow = container.querySelector(".input-arrow");
        const searchInput = container.querySelector(
          ".form-select-chosen__search-input",
        );
        const errorMessage = document.querySelector('[data-error="test"]');
        const wrapper = container.querySelector(".input-wrapper");

        searchBox.style.display = "none";

        function toggleOptions() {
          const isVisible = searchBox.style.display === "block";
          searchBox.style.display = isVisible ? "none" : "block";
          arrow.classList.toggle("active", !isVisible);
          if (!isVisible) {
            searchInput.focus();
            searchInput.value = "";
            options.forEach((opt) => (opt.style.display = "block"));
          }
        }

        arrow.addEventListener("click", (e) => {
          e.stopPropagation();
          toggleOptions();
        });

        output.addEventListener("click", toggleOptions);

        document.addEventListener("click", (e) => {
          if (!container.contains(e.target)) {
            searchBox.style.display = "none";
            arrow.classList.remove("active");
          }
        });

        searchInput.addEventListener("input", function () {
          const q = this.value.toLowerCase().trim();
          options.forEach((opt) => {
            opt.style.display = opt.textContent.toLowerCase().includes(q)
              ? "block"
              : "none";
          });
        });

        options.forEach((opt) => {
          opt.addEventListener("click", function () {
            const value = this.textContent;
            input.value = value;
            input.dataset.value = this.dataset.value;
            output.textContent = value;
            searchBox.style.display = "none";
            arrow.classList.remove("active");
            input.classList.remove("error-class");
            wrapper.classList.remove("error-class");
            errorMessage.style.display = "none";
          });
        });
      });
    </script>
  </body>
</html>
